# JAM-025: Project Directory & Discovery

**Priority**: ðŸŸ¡ High
**Effort**: 2-3 hours
**Dependencies**: JAM-004 (project system), JAM-006 (API structure)

## ðŸ“‹ Objective

Create a **Project Directory** page at `/jam/projects` that allows mentors, builders, and admins to browse, search, and filter all projects within the Jam Platform. This enables mentor discovery of projects needing support and community engagement.

**User Story**: _"As a mentor, I want to easily search and filter through projects, so I can support them with mentorship"_

## âœ… Acceptance Criteria

- [ ] Project directory page at `/jam/projects` showing all projects
- [ ] Search functionality by project name/description
- [ ] Filter by category (Web3, DeFi, NFT, Gaming, Social, Infrastructure, AI, Other)
- [ ] Filter by stage (IDEA, PROTOTYPE, BUILD, PROJECT)
- [ ] Display project cards with key information (name, description, badges)
- [ ] Show member count and program participation badges
- [ ] Click cards to navigate to individual project pages
- [ ] "Explorar Proyectos" navigation link in sidebar
- [ ] Mobile-responsive grid layout
- [ ] Loading and error states with TanStack Query

## ðŸ› ï¸ Implementation

### Files to Create/Modify
- `src/app/jam/projects/page.tsx` - NEW project directory page
- `src/components/jam-platform/projects/ProjectCard.tsx` - NEW reusable card
- `src/components/jam-platform/projects/ProjectFilters.tsx` - NEW filter controls
- `src/app/api/jam/projects/route.ts` - MODIFY to add query param filtering
- `src/components/jam-platform/navigation/JamNav.tsx` - MODIFY to add nav link

### Project Directory Page

```tsx
// src/app/jam/projects/page.tsx
'use client';

import { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { useAppAuth } from '@/hooks/use-app-auth';
import { PageWrapper } from '@/components/layout/page-wrapper';
import { JamNav } from '@/components/jam-platform/navigation/JamNav';
import { ProjectCard } from '@/components/jam-platform/projects/ProjectCard';
import { ProjectFilters } from '@/components/jam-platform/projects/ProjectFilters';
import { Loader2 } from 'lucide-react';

export default function ProjectsPage() {
  const { isAppAuthenticated, isLoading: authLoading } = useAppAuth();
  const [searchQuery, setSearchQuery] = useState('');
  const [categoryFilter, setCategoryFilter] = useState('ALL');
  const [stageFilter, setStageFilter] = useState('ALL');

  const { data: projects = [], isLoading } = useQuery({
    queryKey: ['projects'],
    queryFn: async () => {
      const res = await fetch('/api/jam/projects');
      if (!res.ok) throw new Error('Failed to fetch projects');
      return res.json();
    },
    enabled: isAppAuthenticated,
  });

  // Client-side filtering
  const filteredProjects = projects.filter((project: any) => {
    const matchesSearch =
      searchQuery === '' ||
      project.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      project.description.toLowerCase().includes(searchQuery.toLowerCase());

    const matchesCategory =
      categoryFilter === 'ALL' || project.category === categoryFilter;

    const matchesStage =
      stageFilter === 'ALL' || project.stage === stageFilter;

    return matchesSearch && matchesCategory && matchesStage;
  });

  if (authLoading || isLoading) {
    return (
      <PageWrapper>
        <div className="page py-6">
          <div className="sticky top-0 z-10">
            <JamNav />
          </div>
          <div className="container max-w-6xl pl-64">
            <div className="flex min-h-[400px] items-center justify-center">
              <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
            </div>
          </div>
        </div>
      </PageWrapper>
    );
  }

  return (
    <PageWrapper>
      <div className="page py-6">
        <div className="sticky top-0 z-10">
          <JamNav />
        </div>
        <div className="container max-w-6xl space-y-6 pl-64">
          <div>
            <h1 className="text-3xl font-bold">Explorar Proyectos</h1>
            <p className="text-muted-foreground mt-2">
              Descubre proyectos de la comunidad y ofrece tu apoyo como mentor
            </p>
          </div>

          <ProjectFilters
            searchQuery={searchQuery}
            onSearchChange={setSearchQuery}
            categoryFilter={categoryFilter}
            onCategoryChange={setCategoryFilter}
            stageFilter={stageFilter}
            onStageChange={setStageFilter}
          />

          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <p className="text-sm text-muted-foreground">
                {filteredProjects.length} proyecto{filteredProjects.length !== 1 ? 's' : ''} encontrado{filteredProjects.length !== 1 ? 's' : ''}
              </p>
            </div>

            {filteredProjects.length === 0 ? (
              <div className="text-center py-12">
                <p className="text-muted-foreground">
                  No se encontraron proyectos con los filtros seleccionados
                </p>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {filteredProjects.map((project: any) => (
                  <ProjectCard key={project.id} project={project} />
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    </PageWrapper>
  );
}
```

### Project Card Component

```tsx
// src/components/jam-platform/projects/ProjectCard.tsx
import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Users, ExternalLink } from 'lucide-react';

interface ProjectCardProps {
  project: {
    id: string;
    name: string;
    slug: string;
    description: string;
    category: string | null;
    stage: string;
    memberCount?: number;
    programCount?: number;
  };
}

export function ProjectCard({ project }: ProjectCardProps) {
  const truncatedDescription =
    project.description.length > 120
      ? project.description.slice(0, 120) + '...'
      : project.description;

  return (
    <Link href={`/jam/projects/${project.slug}`}>
      <Card className="h-full hover:shadow-lg transition-all hover:border-primary cursor-pointer">
        <CardHeader>
          <div className="flex items-start justify-between gap-2">
            <CardTitle className="text-lg line-clamp-2">
              {project.name}
            </CardTitle>
            <ExternalLink className="h-4 w-4 text-muted-foreground flex-shrink-0" />
          </div>
          <div className="flex flex-wrap gap-2 mt-2">
            {project.category && (
              <Badge variant="secondary">{project.category}</Badge>
            )}
            <Badge variant="outline">{project.stage}</Badge>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <p className="text-sm text-muted-foreground line-clamp-3">
            {truncatedDescription}
          </p>

          <div className="flex items-center gap-4 text-xs text-muted-foreground">
            {project.memberCount !== undefined && (
              <div className="flex items-center gap-1">
                <Users className="h-3 w-3" />
                <span>{project.memberCount} miembro{project.memberCount !== 1 ? 's' : ''}</span>
              </div>
            )}
            {project.programCount !== undefined && project.programCount > 0 && (
              <Badge variant="secondary" className="text-xs">
                {project.programCount} programa{project.programCount !== 1 ? 's' : ''}
              </Badge>
            )}
          </div>
        </CardContent>
      </Card>
    </Link>
  );
}
```

### Project Filters Component

```tsx
// src/components/jam-platform/projects/ProjectFilters.tsx
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Search } from 'lucide-react';

interface ProjectFiltersProps {
  searchQuery: string;
  onSearchChange: (value: string) => void;
  categoryFilter: string;
  onCategoryChange: (value: string) => void;
  stageFilter: string;
  onStageChange: (value: string) => void;
}

export function ProjectFilters({
  searchQuery,
  onSearchChange,
  categoryFilter,
  onCategoryChange,
  stageFilter,
  onStageChange,
}: ProjectFiltersProps) {
  return (
    <div className="space-y-4 p-4 border rounded-lg bg-card">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* Search */}
        <div className="md:col-span-3">
          <Label htmlFor="search">Buscar</Label>
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              id="search"
              type="text"
              placeholder="Buscar por nombre o descripciÃ³n..."
              value={searchQuery}
              onChange={(e) => onSearchChange(e.target.value)}
              className="pl-9"
            />
          </div>
        </div>

        {/* Category Filter */}
        <div>
          <Label htmlFor="category">CategorÃ­a</Label>
          <Select value={categoryFilter} onValueChange={onCategoryChange}>
            <SelectTrigger id="category">
              <SelectValue placeholder="Todas las categorÃ­as" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="ALL">Todas</SelectItem>
              <SelectItem value="Web3">Web3/Blockchain</SelectItem>
              <SelectItem value="DeFi">DeFi</SelectItem>
              <SelectItem value="NFT">NFT/Digital Art</SelectItem>
              <SelectItem value="Gaming">Gaming</SelectItem>
              <SelectItem value="Social">Social</SelectItem>
              <SelectItem value="Infrastructure">Infrastructure</SelectItem>
              <SelectItem value="AI">AI/ML</SelectItem>
              <SelectItem value="Other">Other</SelectItem>
            </SelectContent>
          </Select>
        </div>

        {/* Stage Filter */}
        <div>
          <Label htmlFor="stage">Etapa</Label>
          <Select value={stageFilter} onValueChange={onStageChange}>
            <SelectTrigger id="stage">
              <SelectValue placeholder="Todas las etapas" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="ALL">Todas</SelectItem>
              <SelectItem value="IDEA">Idea</SelectItem>
              <SelectItem value="PROTOTYPE">Prototype</SelectItem>
              <SelectItem value="BUILD">Building</SelectItem>
              <SelectItem value="PROJECT">Live Project</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>
    </div>
  );
}
```

### Navigation Update

```tsx
// src/components/jam-platform/navigation/JamNav.tsx
// Add this link after "Crear Proyecto":

import { Grid3x3 } from 'lucide-react';

// Inside the navigation items:
<NavLink href="/jam/projects" icon={Grid3x3}>
  Explorar Proyectos
</NavLink>
```

### API Enhancement (Optional - for future server-side filtering)

```typescript
// src/app/api/jam/projects/route.ts
// Modify GET handler to support query params:

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const userId = searchParams.get('userId');
    const category = searchParams.get('category');
    const stage = searchParams.get('stage');

    let query = db.select().from(projects);

    // Apply filters
    const conditions = [];
    if (userId) {
      conditions.push(eq(projectMembers.userId, userId));
    }
    if (category && category !== 'ALL') {
      conditions.push(eq(projects.category, category));
    }
    if (stage && stage !== 'ALL') {
      conditions.push(eq(projects.stage, stage));
    }

    if (userId) {
      const userProjects = await db
        .select({
          project: projects,
          membership: projectMembers,
        })
        .from(projectMembers)
        .innerJoin(projects, eq(projectMembers.projectId, projects.id))
        .where(and(...conditions));

      return NextResponse.json(userProjects);
    }

    // Get all projects with optional filters
    if (conditions.length > 0) {
      const filteredProjects = await db
        .select()
        .from(projects)
        .where(and(...conditions));
      return NextResponse.json(filteredProjects);
    }

    const allProjects = await db.select().from(projects);
    return NextResponse.json(allProjects);
  } catch (error) {
    console.error('Projects fetch error:', error);
    return NextResponse.json(
      { error: 'Failed to fetch projects' },
      { status: 500 }
    );
  }
}
```

## ðŸŽ¯ Testing

1. **Project directory display**
   - All projects load in grid layout
   - Project cards show correct information
   - Cards are clickable and navigate to detail page

2. **Search functionality**
   - Search filters by project name
   - Search filters by description text
   - Empty search shows all projects

3. **Filter functionality**
   - Category filter works correctly
   - Stage filter works correctly
   - Multiple filters combine properly
   - "ALL" option shows unfiltered results

4. **Responsive design**
   - Grid adapts to mobile (1 column)
   - Grid adapts to tablet (2 columns)
   - Grid adapts to desktop (3 columns)

5. **Navigation**
   - "Explorar Proyectos" link appears in sidebar
   - Link navigates to correct page
   - Active state shows on projects page

## ðŸ’¡ Notes

- **Client-side filtering** initially (simple and fast for MVP)
- **Server-side filtering** can be added later for large datasets
- Member count can be fetched via join or added to response
- Program count requires querying `program_projects` junction table
- Keep card descriptions truncated for consistent layout
- Use hover effects for better UX

## ðŸš¨ Potential Issues

- **Performance**: If 100+ projects, consider pagination or virtual scrolling
- **Member count**: Need to count from `project_members` table
- **Program count**: Need to count from `program_projects` table
- **Empty states**: Handle no projects gracefully
- **Search performance**: Client-side is fine for <200 projects
- **Filter combinations**: Test edge cases (no results, all filters active)
