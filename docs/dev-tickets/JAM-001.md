# JAM-001: Database Schema Migration

**Priority**: üî¥ Critical  
**Effort**: 2-3 hours  
**Dependencies**: None (start here!)  

## üìã Objective

Migrate the existing database schema to support the Jam platform MVP features. Add new tables and columns needed for mentorship coordination, quest tracking, and program management.

## ‚úÖ Acceptance Criteria

- [ ] Database migrations created and tested
- [ ] New `mentorships` table created
- [ ] Existing tables enhanced with required columns
- [ ] Migration runs without errors
- [ ] Rollback script included

## üõ†Ô∏è Implementation

### Files to Create/Modify
- `drizzle/migrations/[timestamp]_jam_platform.sql`
- `src/db/schema/index.ts` (update TypeScript schema)

### Key Schema Changes

```sql
-- 1. Create mentorships table
CREATE TABLE mentorships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  mentor_id UUID NOT NULL REFERENCES users(id),
  participant_id UUID NOT NULL REFERENCES users(id),
  status TEXT DEFAULT 'active',
  session_notes JSONB,
  mentor_rating INTEGER,
  participant_rating INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. Enhance programs table
ALTER TABLE programs ADD COLUMN organizer TEXT;
ALTER TABLE programs ADD COLUMN application_url TEXT;
ALTER TABLE programs ADD COLUMN submission_deadline TIMESTAMP;
ALTER TABLE programs ADD COLUMN tracks TEXT[];

-- 3. Enhance projects table
ALTER TABLE projects ADD COLUMN repository_url TEXT;
ALTER TABLE projects ADD COLUMN video_url TEXT;
ALTER TABLE projects ADD COLUMN production_url TEXT;
ALTER TABLE projects ADD COLUMN website TEXT;

-- 4. Enhance quests table
ALTER TABLE quests ADD COLUMN available_from TIMESTAMP;
ALTER TABLE quests ADD COLUMN due_date TIMESTAMP;
ALTER TABLE quests ADD COLUMN category TEXT;
ALTER TABLE quests ADD COLUMN difficulty TEXT;

-- 5. Enhance user_quests table
ALTER TABLE user_quests ADD COLUMN submission_text TEXT;
ALTER TABLE user_quests ADD COLUMN submission_urls TEXT[];
```

### Quick Steps

1. **Create migration file**
   ```bash
   bun drizzle-kit generate:pg
   ```

2. **Run migration**
   ```bash
   bun db:migrate
   ```

3. **Update TypeScript schema**
   - Add mentorships table definition
   - Update existing table types

## üéØ Testing

```bash
# Test migration
bun db:migrate

# Verify tables
psql $DATABASE_URL -c "\dt"

# Check new columns
psql $DATABASE_URL -c "\d programs"
```

## üí° Notes

- Keep existing data intact
- Use TEXT instead of ENUMs for flexibility
- JSONB for flexible session_notes storage
- Add indexes for foreign keys if performance needed later

## üö® Potential Issues

- **Database connection**: Make sure `.env` has correct DATABASE_URL
- **Permissions**: User needs CREATE/ALTER privileges
- **Existing data**: Migration should not break existing records