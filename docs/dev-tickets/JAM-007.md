# JAM-007: Quest Management System

**Priority**: üî¥ Critical  
**Effort**: 4-5 hours  
**Dependencies**: JAM-006 (API structure)  

## üìã Objective

Build the quest system that assigns weekly deliverables to participants. Quests are the core mechanism for tracking progress and ensuring accountability in the program.

## ‚úÖ Acceptance Criteria

- [ ] Quest listing page with filters
- [ ] Quest detail view with requirements
- [ ] Quest assignment based on track/week
- [ ] Progress tracking (0-100%)
- [ ] Quest categories and difficulty levels
- [ ] Automatic quest unlocking by week

## üõ†Ô∏è Implementation

### Files to Create/Modify
- `src/app/jam/quests/page.tsx` - Quest listing
- `src/app/jam/quests/[id]/page.tsx` - Quest details
- `src/components/jam-platform/quests/` - Quest components
- `src/lib/jam/quests.ts` - Quest logic
- `src/app/api/jam/quests/route.ts` - Quest API

### Quest Data Model

```typescript
interface Quest {
  id: string;
  title: string;
  description: string;
  category: 'technical' | 'community' | 'learning' | 'project';
  difficulty: 'easy' | 'medium' | 'hard';
  rewardPoints: number;
  availableFrom: Date;
  dueDate: Date;
  requirements: string[];
  deliverables: string[];
}

interface UserQuest {
  id: string;
  userId: string;
  questId: string;
  status: 'not_started' | 'in_progress' | 'completed';
  progress: number; // 0-100
  startedAt?: Date;
  completedAt?: Date;
}
```

### Quest Listing Page

```tsx
// src/app/jam/quests/page.tsx
export default async function QuestsPage() {
  const user = await getCurrentUser();
  const quests = await getUserQuests(user.id);
  
  return (
    <div className="container py-6">
      <h1 className="text-3xl font-bold mb-6">Your Quests</h1>
      
      <QuestFilters />
      
      <div className="grid gap-4 mt-6">
        <QuestSection
          title="This Week"
          quests={quests.current}
          highlight
        />
        <QuestSection
          title="Upcoming"
          quests={quests.upcoming}
        />
        <QuestSection
          title="Completed"
          quests={quests.completed}
          collapsed
        />
      </div>
    </div>
  );
}
```

### Quest Card Component

```tsx
// src/components/jam-platform/quests/QuestCard.tsx
export function QuestCard({ quest, userQuest }) {
  return (
    <Card className="hover:shadow-lg transition-shadow">
      <CardHeader>
        <div className="flex justify-between items-start">
          <div>
            <CardTitle>{quest.title}</CardTitle>
            <div className="flex gap-2 mt-2">
              <Badge variant="outline">{quest.category}</Badge>
              <Badge variant={getDifficultyVariant(quest.difficulty)}>
                {quest.difficulty}
              </Badge>
              <Badge variant="secondary">
                {quest.rewardPoints} points
              </Badge>
            </div>
          </div>
          <QuestStatus status={userQuest?.status || 'not_started'} />
        </div>
      </CardHeader>
      
      <CardContent>
        <p className="text-muted-foreground mb-4">
          {quest.description}
        </p>
        
        {userQuest && (
          <div className="space-y-2">
            <div className="flex justify-between text-sm">
              <span>Progress</span>
              <span>{userQuest.progress}%</span>
            </div>
            <Progress value={userQuest.progress} />
          </div>
        )}
        
        <div className="flex justify-between items-center mt-4">
          <span className="text-sm text-muted-foreground">
            Due {formatDate(quest.dueDate)}
          </span>
          <Button asChild>
            <Link href={`/jam/quests/${quest.id}`}>
              View Details
            </Link>
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

### Quest Assignment Logic

```typescript
// src/lib/jam/quests.ts
export async function assignWeeklyQuests(userId: string) {
  const user = await getUserWithProfile(userId);
  const currentWeek = getCurrentProgramWeek();
  
  // Get quests for user's track and current week
  const quests = await db.select()
    .from(questsTable)
    .where(
      and(
        eq(questsTable.week, currentWeek),
        or(
          eq(questsTable.track, user.track),
          eq(questsTable.track, 'all')
        )
      )
    );
  
  // Assign quests to user
  for (const quest of quests) {
    await db.insert(userQuestsTable)
      .values({
        userId,
        questId: quest.id,
        status: 'not_started',
        progress: 0
      })
      .onConflictDoNothing();
  }
}

export function getQuestFilters() {
  return {
    status: ['not_started', 'in_progress', 'completed'],
    category: ['technical', 'community', 'learning', 'project'],
    difficulty: ['easy', 'medium', 'hard'],
    week: ['current', 'upcoming', 'past']
  };
}
```

### Quest Detail Page

```tsx
// src/app/jam/quests/[id]/page.tsx
export default async function QuestDetailPage({ params }) {
  const quest = await getQuest(params.id);
  const userQuest = await getUserQuest(params.id);
  
  return (
    <div className="container max-w-4xl py-6">
      <QuestHeader quest={quest} />
      
      <div className="grid md:grid-cols-3 gap-6 mt-6">
        <div className="md:col-span-2 space-y-6">
          <QuestRequirements requirements={quest.requirements} />
          <QuestDeliverables deliverables={quest.deliverables} />
          <QuestSubmissionForm questId={quest.id} />
        </div>
        
        <div className="space-y-4">
          <QuestProgress userQuest={userQuest} />
          <QuestRewards points={quest.rewardPoints} />
          <QuestDeadline dueDate={quest.dueDate} />
        </div>
      </div>
    </div>
  );
}
```

## üéØ Testing

1. **Quest display**
   - All assigned quests show
   - Filters work correctly
   - Status badges accurate

2. **Quest assignment**
   - Weekly quests auto-assigned
   - Track-specific quests work
   - No duplicate assignments

3. **Progress tracking**
   - Progress updates save
   - Status changes work
   - Completion triggers rewards

## üí° Notes

- Pre-populate quests in database seed
- Consider quest dependencies later
- Weekly assignment could be cron job
- Cache quest data for performance

## üö® Potential Issues

- **Time zones**: Use UTC for consistency
- **Quest availability**: Check dates carefully
- **Progress validation**: Ensure 0-100 range
- **Duplicate assignments**: Use unique constraints