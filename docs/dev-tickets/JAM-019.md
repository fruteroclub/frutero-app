# JAM-019: Rating & Feedback System

**Priority**: üü° Medium  
**Effort**: 3-4 hours  
**Dependencies**: JAM-011 (session tracking)  

## üìã Objective

Implement a mutual rating and feedback system for mentorship sessions. Enable quality monitoring and continuous improvement of the mentorship experience.

## ‚úÖ Acceptance Criteria

- [ ] Session rating interface (1-5 stars)
- [ ] Written feedback collection
- [ ] Mutual rating (mentor rates participant too)
- [ ] Rating analytics and trends
- [ ] Quality alerts for low ratings
- [ ] Anonymous feedback option

## üõ†Ô∏è Implementation

### Files to Create/Modify
- `src/components/jam-platform/sessions/SessionRating.tsx`
- `src/app/jam/feedback/page.tsx` - Feedback overview
- `src/app/api/jam/sessions/[id]/rate/route.ts`
- `src/lib/jam/ratings.ts` - Rating logic

### Session Rating Component

```tsx\n// src/components/jam-platform/sessions/SessionRating.tsx\nexport function SessionRatingModal({ session, userType, onSubmit, onClose }) {\n  const [rating, setRating] = useState(0);\n  const [feedback, setFeedback] = useState('');\n  const [anonymous, setAnonymous] = useState(false);\n  const [categories, setCategories] = useState({\n    preparation: 0,\n    communication: 0,\n    helpfulness: 0,\n    followup: 0\n  });\n  \n  const isParticipant = userType === 'participant';\n  const isRequired = rating === 1 || rating === 2; // Low ratings require feedback\n  \n  return (\n    <Dialog open onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle>\n            Rate Your Session with {isParticipant ? session.mentor.displayName : session.participant.displayName}\n          </DialogTitle>\n          <DialogDescription>\n            Your feedback helps improve the mentorship experience\n          </DialogDescription>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Overall Rating */}\n          <div className=\"text-center\">\n            <Label className=\"text-lg font-medium\">Overall Rating</Label>\n            <div className=\"flex justify-center mt-2\">\n              <StarRating\n                value={rating}\n                onChange={setRating}\n                size=\"lg\"\n                required\n              />\n            </div>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              {getRatingLabel(rating)}\n            </p>\n          </div>\n          \n          {/* Category Ratings */}\n          <div className=\"space-y-4\">\n            <Label>Detailed Feedback</Label>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <RatingCategory\n                label=\"Preparation\"\n                value={categories.preparation}\n                onChange={(value) => updateCategory('preparation', value)}\n                description={isParticipant ? \"Mentor came prepared\" : \"Participant came prepared\"}\n              />\n              <RatingCategory\n                label=\"Communication\"\n                value={categories.communication}\n                onChange={(value) => updateCategory('communication', value)}\n                description=\"Clear and effective communication\"\n              />\n              <RatingCategory\n                label=\"Helpfulness\"\n                value={categories.helpfulness}\n                onChange={(value) => updateCategory('helpfulness', value)}\n                description={isParticipant ? \"Provided valuable guidance\" : \"Engaged and asked good questions\"}\n              />\n              <RatingCategory\n                label=\"Follow-up\"\n                value={categories.followup}\n                onChange={(value) => updateCategory('followup', value)}\n                description=\"Clear next steps and action items\"\n              />\n            </div>\n          </div>\n          \n          {/* Written Feedback */}\n          <div>\n            <Label>Additional Comments {isRequired && '*'}</Label>\n            <Textarea\n              value={feedback}\n              onChange={(e) => setFeedback(e.target.value)}\n              placeholder={isParticipant \n                ? \"What went well? What could be improved? Any suggestions for your mentor?\"\n                : \"How engaged was the participant? Any areas for improvement?\"\n              }\n              rows={4}\n              required={isRequired}\n            />\n            {isRequired && (\n              <p className=\"text-sm text-orange-600 mt-1\">\n                Low ratings require written feedback to help us improve\n              </p>\n            )}\n          </div>\n          \n          {/* Anonymous Option */}\n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              id=\"anonymous\"\n              checked={anonymous}\n              onCheckedChange={setAnonymous}\n            />\n            <Label htmlFor=\"anonymous\">\n              Submit feedback anonymously\n            </Label>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Skip for Now\n            </Button>\n            <Button type=\"submit\" disabled={rating === 0}>\n              Submit Rating\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction RatingCategory({ label, value, onChange, description }) {\n  return (\n    <div className=\"space-y-2\">\n      <div>\n        <Label className=\"text-sm font-medium\">{label}</Label>\n        <p className=\"text-xs text-muted-foreground\">{description}</p>\n      </div>\n      <StarRating\n        value={value}\n        onChange={onChange}\n        size=\"sm\"\n      />\n    </div>\n  );\n}\n\nfunction StarRating({ value, onChange, size = \"md\", readonly = false }) {\n  const sizes = {\n    sm: \"h-4 w-4\",\n    md: \"h-5 w-5\",\n    lg: \"h-8 w-8\"\n  };\n  \n  return (\n    <div className=\"flex gap-1\">\n      {[1, 2, 3, 4, 5].map(star => (\n        <button\n          key={star}\n          type=\"button\"\n          disabled={readonly}\n          onClick={() => !readonly && onChange(star)}\n          className={cn(\n            \"transition-colors\",\n            readonly ? \"cursor-default\" : \"cursor-pointer hover:text-yellow-400\"\n          )}\n        >\n          <Star\n            className={cn(\n              sizes[size],\n              star <= value \n                ? \"fill-yellow-400 text-yellow-400\" \n                : \"text-gray-300\"\n            )}\n          />\n        </button>\n      ))}\n    </div>\n  );\n}\n\nfunction getRatingLabel(rating: number): string {\n  switch (rating) {\n    case 1: return \"Poor - Major issues\";\n    case 2: return \"Below expectations\";\n    case 3: return \"Met expectations\";\n    case 4: return \"Exceeded expectations\";\n    case 5: return \"Outstanding!\";\n    default: return \"Click to rate\";\n  }\n}\n```\n\n### Rating API\n\n```typescript\n// src/app/api/jam/sessions/[id]/rate/route.ts\nexport const POST = withAuth(async (request: Request, { params }) => {\n  const sessionId = params.id;\n  const userId = request.user.id;\n  const data = await request.json();\n  \n  // Validate session exists and user participated\n  const session = await getSession(sessionId);\n  if (!session) {\n    throw new NotFoundError('Session not found');\n  }\n  \n  const userRole = session.mentorId === userId ? 'mentor' : \n                   session.participantId === userId ? 'participant' : null;\n  \n  if (!userRole) {\n    throw new ForbiddenError('Not authorized to rate this session');\n  }\n  \n  // Check if already rated\n  const existingRating = await db.select()\n    .from(sessionRatingsTable)\n    .where(\n      and(\n        eq(sessionRatingsTable.sessionId, sessionId),\n        eq(sessionRatingsTable.raterId, userId)\n      )\n    )\n    .limit(1);\n    \n  if (existingRating[0]) {\n    throw new ConflictError('Session already rated');\n  }\n  \n  // Create rating\n  const rating = await db.insert(sessionRatingsTable).values({\n    sessionId,\n    raterId: userId,\n    raterRole: userRole,\n    overallRating: data.rating,\n    categoryRatings: data.categories,\n    feedback: data.feedback,\n    isAnonymous: data.anonymous || false,\n    createdAt: new Date()\n  }).returning();\n  \n  // Update mentorship rating averages\n  await updateMentorshipRatings(session.mentorshipId);\n  \n  // Check for quality alerts\n  if (data.rating <= 2) {\n    await createQualityAlert(sessionId, userId, data.rating, data.feedback);\n  }\n  \n  // Notify other party (if not anonymous)\n  if (!data.anonymous) {\n    const recipientId = userRole === 'mentor' ? session.participantId : session.mentorId;\n    await notifyRatingReceived(recipientId, sessionId, data.rating);\n  }\n  \n  return successResponse(rating[0], 'Rating submitted successfully');\n});\n```\n\n### Feedback Analytics\n\n```typescript\n// src/lib/jam/ratings.ts\nexport async function getMentorRatingStats(mentorId: string) {\n  const ratings = await db.select()\n    .from(sessionRatingsTable)\n    .innerJoin(sessionsTable, eq(sessionRatingsTable.sessionId, sessionsTable.id))\n    .where(\n      and(\n        eq(sessionsTable.mentorId, mentorId),\n        eq(sessionRatingsTable.raterRole, 'participant')\n      )\n    );\n  \n  if (ratings.length === 0) {\n    return {\n      averageRating: 0,\n      totalRatings: 0,\n      ratingDistribution: {},\n      categoryAverages: {},\n      recentTrend: 'stable'\n    };\n  }\n  \n  const totalRating = ratings.reduce((sum, r) => sum + r.overallRating, 0);\n  const averageRating = totalRating / ratings.length;\n  \n  const ratingDistribution = ratings.reduce((dist, r) => {\n    dist[r.overallRating] = (dist[r.overallRating] || 0) + 1;\n    return dist;\n  }, {});\n  \n  const categoryAverages = ratings.reduce((avgs, r) => {\n    Object.entries(r.categoryRatings || {}).forEach(([category, rating]) => {\n      if (!avgs[category]) avgs[category] = [];\n      avgs[category].push(rating);\n    });\n    return avgs;\n  }, {});\n  \n  // Calculate averages for each category\n  Object.keys(categoryAverages).forEach(category => {\n    const values = categoryAverages[category];\n    categoryAverages[category] = values.reduce((sum, val) => sum + val, 0) / values.length;\n  });\n  \n  // Calculate recent trend (last 5 vs previous 5)\n  const recentRatings = ratings.slice(-5).map(r => r.overallRating);\n  const previousRatings = ratings.slice(-10, -5).map(r => r.overallRating);\n  \n  const recentAvg = recentRatings.reduce((sum, r) => sum + r, 0) / recentRatings.length;\n  const previousAvg = previousRatings.length > 0 \n    ? previousRatings.reduce((sum, r) => sum + r, 0) / previousRatings.length\n    : recentAvg;\n  \n  let recentTrend = 'stable';\n  if (recentAvg > previousAvg + 0.2) recentTrend = 'improving';\n  else if (recentAvg < previousAvg - 0.2) recentTrend = 'declining';\n  \n  return {\n    averageRating,\n    totalRatings: ratings.length,\n    ratingDistribution,\n    categoryAverages,\n    recentTrend\n  };\n}\n\nexport async function createQualityAlert(\n  sessionId: string,\n  raterId: string,\n  rating: number,\n  feedback: string\n) {\n  // Create alert for admin review\n  await db.insert(qualityAlertsTable).values({\n    sessionId,\n    raterId,\n    rating,\n    feedback,\n    status: 'pending',\n    createdAt: new Date()\n  });\n  \n  // Notify administrators\n  await notifyAdminsOfQualityIssue(sessionId, rating, feedback);\n}\n```\n\n### Feedback Overview Page\n\n```tsx\n// src/app/jam/feedback/page.tsx\nexport default async function FeedbackPage() {\n  const user = await getCurrentUser();\n  const feedbackStats = await getUserFeedbackStats(user.id);\n  const recentFeedback = await getRecentFeedback(user.id);\n  \n  return (\n    <div className=\"container py-6\">\n      <h1 className=\"text-3xl font-bold mb-6\">Feedback & Ratings</h1>\n      \n      <div className=\"grid md:grid-cols-2 gap-6 mb-8\">\n        <RatingStatsCard stats={feedbackStats.received} title=\"Feedback Received\" />\n        <RatingStatsCard stats={feedbackStats.given} title=\"Feedback Given\" />\n      </div>\n      \n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <FeedbackList \n          feedback={recentFeedback.received} \n          title=\"Recent Feedback Received\"\n          type=\"received\"\n        />\n        <FeedbackList \n          feedback={recentFeedback.given} \n          title=\"Recent Feedback Given\"\n          type=\"given\"\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction RatingStatsCard({ stats, title }) {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>{title}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-center mb-4\">\n          <div className=\"text-3xl font-bold\">{stats.average.toFixed(1)}</div>\n          <div className=\"flex justify-center mt-1\">\n            <StarRating value={Math.round(stats.average)} readonly />\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            Based on {stats.total} ratings\n          </p>\n        </div>\n        \n        <div className=\"space-y-2\">\n          {Object.entries(stats.distribution).map(([rating, count]) => (\n            <div key={rating} className=\"flex items-center gap-2\">\n              <span className=\"text-sm w-6\">{rating}‚òÖ</span>\n              <Progress value={(count / stats.total) * 100} className=\"flex-1\" />\n              <span className=\"text-sm text-muted-foreground w-8\">{count}</span>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n```\n\n## üéØ Testing\n\n1. **Rating submission**\n   - Form validates properly\n   - Ratings save correctly\n   - Anonymous option works\n\n2. **Rating analytics**\n   - Averages calculated correctly\n   - Trends identified properly\n   - Quality alerts triggered\n\n3. **Feedback display**\n   - Anonymous feedback hidden properly\n   - Feedback history accessible\n   - Stats display accurately\n\n## üí° Notes\n\n- Consider rating prompts after sessions\n- Add rating reminders for incomplete ratings\n- Track rating response rates\n- Consider rating calibration between users\n\n## üö® Potential Issues\n\n- **Rating bias**: Users may rate higher/lower consistently\n- **Anonymous feedback**: Ensure complete anonymity\n- **Low response rates**: May need incentives\n- **Gaming**: Prevent fake ratings or retaliation