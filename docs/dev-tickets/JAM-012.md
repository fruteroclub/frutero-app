# JAM-012: Project Stage Advancement

**Priority**: ðŸŸ¡ High  
**Effort**: 2-3 hours  
**Dependencies**: JAM-008 (quest submissions)  

## ðŸ“‹ Objective

Implement automatic project stage progression based on quest completion. Move projects through IDEA â†’ PROTOTYPE â†’ BUILD â†’ PROJECT stages.

## âœ… Acceptance Criteria

- [ ] Automatic stage advancement logic
- [ ] Stage requirements clearly defined
- [ ] Visual stage indicator
- [ ] Stage change notifications
- [ ] Badge/reward on advancement
- [ ] Manual override for coordinators

## ðŸ› ï¸ Implementation

### Files to Create/Modify
- `src/lib/jam/project-stages.ts` - Stage logic
- `src/components/jam-platform/projects/StageIndicator.tsx`
- `src/app/api/jam/projects/[id]/advance/route.ts`

### Stage Logic

```typescript
// src/lib/jam/project-stages.ts
export const PROJECT_STAGES = {
  IDEA: {
    next: 'PROTOTYPE',
    requiredQuests: 3,
    description: 'Define your project concept',
    badge: 'Ideator'
  },
  PROTOTYPE: {
    next: 'BUILD', 
    requiredQuests: 6,
    description: 'Create working prototype',
    badge: 'Builder'
  },
  BUILD: {
    next: 'PROJECT',
    requiredQuests: 10,
    description: 'Develop full application',
    badge: 'Developer'
  },
  PROJECT: {
    next: null,
    requiredQuests: null,
    description: 'Completed project',
    badge: 'Finisher'
  }
};

export async function checkStageAdvancement(userId: string) {
  const project = await getUserProject(userId);
  const completedQuests = await getCompletedQuestCount(userId);
  
  const currentStage = PROJECT_STAGES[project.stage];
  
  if (currentStage.next && completedQuests >= currentStage.requiredQuests) {
    await advanceProjectStage(project.id, currentStage.next);
    await awardStageBadge(userId, currentStage.badge);
    await notifyStageAdvancement(userId, currentStage.next);
  }
}
```

### Stage Indicator Component

```tsx
// src/components/jam-platform/projects/StageIndicator.tsx
export function StageIndicator({ stage, questsCompleted = 0 }) {
  const stages = Object.keys(PROJECT_STAGES);
  const currentIndex = stages.indexOf(stage);
  
  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        {stages.map((stageName, index) => (
          <div key={stageName} className="flex items-center">
            <div className={cn(
              "w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",
              index <= currentIndex 
                ? "bg-primary text-primary-foreground" 
                : "bg-muted text-muted-foreground"
            )}>
              {index + 1}
            </div>
            
            <div className="ml-2 text-sm">
              <div className={cn(
                "font-medium",
                index === currentIndex && "text-primary"
              )}>
                {stageName}
              </div>
              <div className="text-xs text-muted-foreground">
                {PROJECT_STAGES[stageName].description}
              </div>
            </div>
            
            {index < stages.length - 1 && (
              <div className={cn(
                "flex-1 h-px mx-4",
                index < currentIndex ? "bg-primary" : "bg-muted"
              )} />
            )}
          </div>
        ))}
      </div>
      
      <StageProgress 
        stage={stage}
        questsCompleted={questsCompleted}
      />
    </div>
  );
}

function StageProgress({ stage, questsCompleted }) {
  const stageInfo = PROJECT_STAGES[stage];
  
  if (!stageInfo.next) {
    return (
      <div className="text-center py-4">
        <Badge variant="default" className="text-lg px-4 py-2">
          ðŸŽ‰ Project Complete!
        </Badge>
      </div>
    );
  }
  
  const progress = (questsCompleted / stageInfo.requiredQuests) * 100;
  const remaining = stageInfo.requiredQuests - questsCompleted;
  
  return (
    <div className="space-y-2">
      <div className="flex justify-between text-sm">
        <span>Progress to {stageInfo.next}</span>
        <span>{questsCompleted}/{stageInfo.requiredQuests} quests</span>
      </div>
      <Progress value={progress} />
      <p className="text-xs text-muted-foreground">
        {remaining > 0 
          ? `Complete ${remaining} more quests to advance`
          : 'Ready to advance! Complete any quest to proceed.'
        }
      </p>
    </div>
  );
}
```

## ðŸŽ¯ Testing

- Stage advancement triggers correctly
- Visual indicator updates
- Notifications sent
- Badges awarded

## ðŸ’¡ Notes

- Run stage check after each quest completion
- Consider manual advancement for edge cases
- Track stage advancement metrics

## ðŸš¨ Potential Issues

- **Concurrent updates**: Use database transactions
- **Edge cases**: Handle incomplete profiles
- **Performance**: Cache quest counts